# Настройка Xdebug в PhpStorm для Docker-контейнера (Laravel проект)

## Шаг 1. Настройка PHP интерпретатора (CLI)

**Цель:** Чтобы PhpStorm "видел" PHP внутри контейнера и мог запускать тесты или artisan-команды.

1. **Открой настройки:**
    - Windows/Linux: `File > Settings`
    - Mac: `PhpStorm > Settings/Preferences`

2. **Перейди в раздел:** `PHP`

3. **В поле CLI Interpreter** нажми на `...` (три точки) справа

4. **В открывшемся окне:**
    - Нажми `+`
    - Выбери `From Docker, Vagrant, VMWare, WSL, Remote...`

5. **Настрой подключение:**
    - Выбери радио-кнопку `Docker Compose`
    - В поле `Server` выбери `Docker`
    - В поле `Configuration files` укажи путь к твоему `docker/docker-compose.yml`

   > **Примечание:** PhpStorm должен автоматически подтянуть сервис `app`.

6. **Нажми `OK`**

7. **Проверь соединение:** PhpStorm проверит соединение. Убедись, что:
    - PHP version определяется (должно быть 8.4.x)
    - Xdebug debugger определяется (должно быть 3.4.x)

8. **Нажми `Apply/OK`**

---

## Шаг 2. Настройка порта Xdebug

1. **В настройках перейди:** `PHP > Debug`

2. **В блоке Xdebug:**
    - `Debug port:` **9003** (именно этот порт мы указали в xdebug.ini)
    - Поставь галочку `Can accept external connections`

3. **В блоке External Connections** (чуть ниже):
    - Увеличь `Max. simultaneous connections` до **3 или 5**
    - *Это помогает, если браузер делает несколько запросов одновременно*

4. **Нажми `Apply`**

---

## Шаг 3. Настройка маппинга путей (Servers)

**Важно:** Это самый важный шаг. PhpStorm должен понимать, как локальные файлы соотносятся с файлами в контейнере.

1. **В настройках перейди:** `PHP > Servers`

2. **Нажми `+`**, чтобы добавить новый сервер

3. **Заполни поля:**
    - `Name:` `letomarket` (или любое другое, но запомни его)
    - `Host:` `localhost` (так как сайт открывается по localhost)
    - `Port:` `80` (порт Nginx)
    - `Debugger:` `Xdebug`

4. **Важно:** Поставь галочку `Use path mappings`

5. **Настрой маппинг путей:**
    - В дереве файлов (Project files) найди корень твоего проекта (папку, где лежит `.env` и папка `docker`)
    - Справа в колонке `Absolute path on the server` напиши: `/var/www/html`

6. **Нажми `Apply` и `OK`**

---

## Шаг 4. Запуск отладки

1. **Активируй режим отладки:**
    - В правом верхнем углу PhpStorm найди иконку телефонной трубки («Start Listening for PHP Debug Connections»)
    - Нажми на нее, чтобы она стала **зеленой** (со значком жука)

2. **Настрой брекпоинт:**
    - Открой файл `public/index.php` (или любой контроллер Laravel)
    - Поставь **брекпоинт** (красную точку):
        - Кликни левой кнопкой мыши слева от номера строки

3. **Запусти отладку:**
    - Перейди в браузер
    - Обнови страницу `http://localhost`

---

## **Ожидаемый результат:**

1. Браузер "зависнет" в загрузке
2. В PhpStorm всплывет окно отладки
3. Строка с брекпоинтом будет подсвечена

**Готово! Отладка настроена и работает.**
